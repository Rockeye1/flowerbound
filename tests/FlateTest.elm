module FlateTest exposing (flate, roundtrip)

import Expect
import Flate
import Hex.Convert
import Test exposing (Test, test)


input : String
input =
    """05C0E8A8D0CA40ACD2F0CADDC4E4A6D0CA40D2E640DEDCCA40EED0DE40CADAC4DEC8D2CAE640E8D0CA40E0E4CAC8C2E8DEE45840E8D0CA40CAF0E0D8DEE4CAE45840C2DCC840E8D0CA40E0E4DEE8CAC6E8DEE440C2D8D840C2E840DEDCC6CA5C4090CAE440EED0D2DAE640C2DCC840D0CAE440E0E4D2DAC2D840D0EADCCECAE4E640C8E4D2ECCA40D0CAE440E8DE40D0EADCE840C2DCC840E6D8C2D6CA5840E8DE40CCE4DED8D2C640C2DCC840E0D8C2F25840E8DE40CEEAC2E4C840C2DCC840C6DEDACCDEE4E85840CCDEE4CAECCAE440E6CACAD6D2DCCE40CAF0C6D2E8CADACADCE85C4084EAE840D0CAE440DACAE4C6EAE4D2C2D840D0CAC2E4E840D2E640D2DCDCDEC6CADCE840C2DCC840E6DECCE85840CECADCE8D8CA40C2DCC840C2D8EEC2F2E640EECAD8C6DEDAD2DCCE5C5C5C40D4EAE6E840D8D2D6CA40D0CAE440C4DEE6DEDA5CBBF2437BA10243AB733B93C9026B0BBCD35491119599D08139A5B589B194812185B991CD3969526B0B6B2B937BAB99026B4B6359026B2B637B739D9546526426F756E63792052756E6E65722052756D70954F5264A75696379204E657468657220436C656674A2E9AA5084CAC2E6E8D8F24090EADCE8CAE44098CACEE69080"""


output : String
output =
    """25903F4B033118C6A1E0204E7E0375D0C10F20E2F242C1414144C43F705BAD28E7E49F41BA28E8E056AD053B382828625D1C1C440709E5385FEA7144A9E138C30D21C4A394521057DFC625C9F3CBC3F3BC49CF8BB90911EE781BBF6AEA9A8E5C838C115AA1048C6AD2E7A8C1104F14FACC48B56415B61321159262B16F49A2A4418F0CC084006628C543078AA8288B47DA1A435289E2111310A671804A83AF7813ED85915D68AC510BD640AA9250575270CFC244B08E6541CA946F9127A3BA54660968C5268568C4068F031AD0E306238C8D0307A9B105112A2F55BC5B8E4C99EE53791C4B8F4C364CCB3A250524055AC0448B7534B450500FA53A8E031FA9362078E37FE69AD432729E3AD9C245265BDD9A28BD66DCBEE7F7F9E3FE7225DC1FBF7A38BA3FDD1F3C7C3C7E1B5F9F73FBDCD152A15AC9B8D3B9E58C3B9A2B6C9D9727E756867F17F4D849CFC882D68B43B47DF6CEFF0C4FEDACE7760766F2DB6BF9CD81EC467E75FBF2FB76F6009936A20345FA28AA3FC34017F7FE00"""


roundtrip : Test
roundtrip =
    test "flate roundtrips" <|
        \_ ->
            case input |> Hex.Convert.toBytes of
                Just bytes ->
                    case
                        bytes
                            |> Flate.deflate
                            |> Flate.inflate
                    of
                        Nothing ->
                            Expect.fail "Could not inflate"

                        Just reinflated ->
                            reinflated
                                |> Hex.Convert.toString
                                |> Expect.equal input

                Nothing ->
                    Expect.fail "Could not convert"


flate : Test
flate =
    test "deflate is as expected" <|
        \_ ->
            case input |> Hex.Convert.toBytes of
                Just bytes ->
                    bytes
                        |> Flate.deflate
                        |> Hex.Convert.toString
                        |> Expect.equal output

                Nothing ->
                    Expect.fail "Could not convert"
